<!-- Bread crumb is created dynamically -->
<!-- row -->
<div class="row">

    <!-- col -->
    <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4">
        <h1 class="page-title txt-color-blueDark">

            <!-- PAGE HEADER -->
            <i class="fa-fw fa fa-bar-chart-o"></i>
            Graphs
			<span>>  
				Chart.js
			</span>
        </h1>
    </div>
    <!-- end col -->

    <!-- right side of the page with the sparkline graphs -->
    <!-- col -->
    <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8">
        <!-- sparks -->
        <ul id="sparks">
            <li class="sparks-info">
                <h5> My Income <span class="txt-color-blue">$47,171</span></h5>

                <div class="sparkline txt-color-blue hidden-mobile hidden-md hidden-sm">
                    1300, 1877, 2500, 2577, 2000, 2100, 3000, 2700, 3631, 2471, 2700, 3631, 2471
                </div>
            </li>
            <li class="sparks-info">
                <h5> Site Traffic <span class="txt-color-purple"><i class="fa fa-arrow-circle-up"
                                                                    data-rel="bootstrap-tooltip" title="Increased"></i>&nbsp;45%</span>
                </h5>

                <div class="sparkline txt-color-purple hidden-mobile hidden-md hidden-sm">
                    110,150,300,130,400,240,220,310,220,300, 270, 210
                </div>
            </li>
            <li class="sparks-info">
                <h5> Site Orders <span class="txt-color-greenDark"><i class="fa fa-shopping-cart"></i>&nbsp;2447</span>
                </h5>

                <div class="sparkline txt-color-greenDark hidden-mobile hidden-md hidden-sm">
                    110,150,300,130,400,240,220,310,220,300, 270, 210
                </div>
            </li>
        </ul>
        <!-- end sparks -->
    </div>
    <!-- end col -->

</div>
<!-- end row -->

<!--
	The ID "widget-grid" will start to initialize all widgets below 
	You do not need to use widgets if you dont want to. Simply remove 
	the <section></section> and you can use wells or panels instead 
	-->

<!-- widget grid -->
<section id="widget-grid" class="">

    <!-- row -->
    <div class="row">

        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-6 col-md-6 col-lg-6">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-0" data-widget-colorbutton="false" data-widget-fullscreenbutton="false"
                 data-widget-editbutton="false" data-widget-sortable="false">
                <header>
                    <h2>Line Chart </h2>
                </header>
                <!-- widget div-->
                <div>

                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">

                        <!-- this is what the user will see -->
                        <canvas id="lineChart" height="120"></canvas>

                    </div>
                    <!-- end widget content -->

                </div>
                <!-- end widget div -->

            </div>
            <!-- end widget -->

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-1" data-widget-colorbutton="false" data-widget-fullscreenbutton="false"
                 data-widget-editbutton="false" data-widget-sortable="false">
                <header>
                    <h2>Radar Chart </h2>
                </header>
                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">

                        <!-- this is what the user will see -->
                        <canvas id="radarChart" height="120"></canvas>

                    </div>
                    <!-- end widget content -->

                </div>
                <!-- end widget div -->

            </div>
            <!-- end widget -->

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-3" data-widget-colorbutton="false" data-widget-fullscreenbutton="false"
                 data-widget-editbutton="false" data-widget-sortable="false">
                <header>
                    <h2>Data Artikel Per Portal Chart </h2>
                </header>
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <div class="widget-body">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Nama Kuis<span></span></label>

                            <div class="col-sm-7 id-quiz">
                                <select style="margin: 10px 0;" class="form-control validate[required]"
                                        name="idQuiz" id="id_quiz"
                                        onchange="onComboBoxQuizChange()"
                                        placeholder="Nama Quiz">
                                </select>
                            </div>
                        </div>
                        <!-- this is what the user will see -->
                        <canvas id="dataArtikelRatingChart" height="120"></canvas>
                    </div>

                    <div class="modal fade modal-detail-data-portal" tabindex="-1" role="dialog"
                         aria-labelledby="myModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 class="modal-title">Detail Data Portal</h4>
                                </div>
                                <div class="modal-body">
                                    <table class="table tree table-bordered table-striped table-condensed new-tb-detail-data-portal">
                                        <thead>
                                        <tr>
                                            <td align="center" width="92px">Artikel</td>
                                            <td align="center" width="92px">Rating (%)</td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Batal</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
            <!-- end widget -->
        </article>
        <!-- WIDGET END -->

        <!-- NEW WIDGET START -->
        <article class="col-xs-12 col-sm-6 col-md-6 col-lg-6">

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-2" data-widget-colorbutton="false" data-widget-fullscreenbutton="false"
                 data-widget-editbutton="false" data-widget-sortable="false">
                <header>
                    <h2>Bar Chart </h2>
                </header>
                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <!-- end widget edit box -->
                    <!-- widget content -->
                    <div class="widget-body">
                        <!-- this is what the user will see -->
                        <canvas id="barChart" height="120"></canvas>
                    </div>
                    <!-- end widget content -->
                </div>
            </div>
            <!-- end widget -->

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-4" data-widget-colorbutton="false" data-widget-fullscreenbutton="false"
                 data-widget-editbutton="false" data-widget-sortable="false">
                <header>
                    <h2>Doughnut Chart </h2>
                </header>
                <!-- widget div-->
                <div>
                    <!-- widget edit box -->
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">

                        <!-- this is what the user will see -->
                        <canvas id="doughnutChart" height="120"></canvas>

                    </div>
                    <!-- end widget content -->

                </div>
                <!-- end widget div -->

            </div>
            <!-- end widget -->

            <!-- Widget ID (each widget will need unique ID)-->
            <div class="jarviswidget" id="wid-id-6" data-widget-colorbutton="false" data-widget-fullscreenbutton="false"
                 data-widget-editbutton="false" data-widget-sortable="false">
                <header>
                    <h2>Portal Chart</h2>
                </header>
                <div>
                    <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        <input class="form-control" type="text">
                    </div>
                    <!-- end widget edit box -->

                    <!-- widget content -->
                    <div class="widget-body">
                        <!-- this is what the user will see -->
                        <canvas id="pieChart" height="120"></canvas>

                    </div>
                    <!-- end widget content -->
                </div>
                <!-- end widget div -->
            </div>
            <!-- end widget -->
        </article>
        <!-- WIDGET END -->
    </div>

    <div class="row">
        <!-- a blank row to get started -->
        <div class="col-sm-12">
            <!-- your contents here -->
        </div>
    </div>
</section>
<!-- end widget grid -->

<script type="text/javascript">
    pageSetUp();

    var myNewChart_1, myNewChart_2, chartPortalNameByQuizByArtikel, myNewChart_4, myNewChart_5, chartByPortalName;
    var pieData = [];
    var chartData = [];
    var dataResult = [];
    var idQuiz;
    // pagefunction

    var pagefunction = function () {
        initQuiz();

        // LINE CHART
        // ref: http://www.chartjs.org/docs/#line-chart-introduction
        var lineOptions = {
            ///Boolean - Whether grid lines are shown across the chart
            scaleShowGridLines: true,
            //String - Colour of the grid lines
            scaleGridLineColor: "rgba(0,0,0,.05)",
            //Number - Width of the grid lines
            scaleGridLineWidth: 1,
            //Boolean - Whether the line is curved between points
            bezierCurve: true,
            //Number - Tension of the bezier curve between points
            bezierCurveTension: 0.4,
            //Boolean - Whether to show a dot for each point
            pointDot: true,
            //Number - Radius of each point dot in pixels
            pointDotRadius: 4,
            //Number - Pixel width of point dot stroke
            pointDotStrokeWidth: 1,
            //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
            pointHitDetectionRadius: 20,
            //Boolean - Whether to show a stroke for datasets
            datasetStroke: true,
            //Number - Pixel width of dataset stroke
            datasetStrokeWidth: 2,
            //Boolean - Whether to fill the dataset with a colour
            datasetFill: true,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
        };

        var lineData = {
            labels: ["January", "February", "March", "April", "May", "June", "July"],
            datasets: [
                {
                    label: "My First dataset",
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: [65, 59, 80, 81, 56, 55, 40]
                },
                {
                    label: "My Second dataset",
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
                    data: [28, 48, 40, 19, 86, 27, 90]
                }
            ]
        };

        // render chart
        var ctx = document.getElementById("lineChart").getContext("2d");
        myNewChart_1 = new Chart(ctx).Line(lineData, lineOptions);

        // END LINE CHART

        // BAR CHART

        var barOptions = {
            //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
            scaleBeginAtZero: true,
            //Boolean - Whether grid lines are shown across the chart
            scaleShowGridLines: true,
            //String - Colour of the grid lines
            scaleGridLineColor: "rgba(0,0,0,.05)",
            //Number - Width of the grid lines
            scaleGridLineWidth: 1,
            //Boolean - If there is a stroke on each bar
            barShowStroke: true,
            //Number - Pixel width of the bar stroke
            barStrokeWidth: 1,
            //Number - Spacing between each of the X value sets
            barValueSpacing: 5,
            //Number - Spacing between data sets within X values
            barDatasetSpacing: 1,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
        }

        var barData = {
            labels: ["January", "February", "March", "April", "May", "June", "July"],
            datasets: [
                {
                    label: "My First dataset",
                    fillColor: "rgba(220,220,220,0.5)",
                    strokeColor: "rgba(220,220,220,0.8)",
                    highlightFill: "rgba(220,220,220,0.75)",
                    highlightStroke: "rgba(220,220,220,1)",
                    data: [65, 59, 80, 81, 56, 55, 40]
                },
                {
                    label: "My Second dataset",
                    fillColor: "rgba(151,187,205,0.5)",
                    strokeColor: "rgba(151,187,205,0.8)",
                    highlightFill: "rgba(151,187,205,0.75)",
                    highlightStroke: "rgba(151,187,205,1)",
                    data: [28, 48, 40, 19, 86, 27, 90]
                }
            ]
        };

        // render chart
        var ctx = document.getElementById("barChart").getContext("2d");
        myNewChart_2 = new Chart(ctx).Bar(barData, barOptions);

        // END BAR CHART

        // DOUGNUT CHART

        var doughnutOptions = {
            //Boolean - Whether we should show a stroke on each segment
            segmentShowStroke: true,
            //String - The colour of each segment stroke
            segmentStrokeColor: "#fff",
            //Number - The width of each segment stroke
            segmentStrokeWidth: 2,
            //Number - The percentage of the chart that we cut out of the middle
            percentageInnerCutout: 50, // This is 0 for Pie charts
            //Number - Amount of animation steps
            animationSteps: 100,
            //String - Animation easing effect
            animationEasing: "easeOutBounce",
            //Boolean - Whether we animate the rotation of the Doughnut
            animateRotate: true,
            //Boolean - Whether we animate scaling the Doughnut from the centre
            animateScale: false,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%=segments[i].fillColor%>\"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>"
        };

        var doughnutData = [
            {
                value: 300,
                color: "rgba(220,220,220,0.8)",
                highlight: "rgba(220,220,220,0.7)",
                label: "Grey"
            },
            {
                value: 50,
                color: "rgba(151,187,205,1)",
                highlight: "rgba(151,187,205,0.8)",
                label: "Blue"
            },
            {
                value: 100,
                color: "rgba(169, 3, 41, 0.7)",
                highlight: "rgba(169, 3, 41, 0.7)",
                label: "Red"
            }
        ];

        // render chart
        var ctx = document.getElementById("doughnutChart").getContext("2d");
        myNewChart_4 = new Chart(ctx).Doughnut(doughnutData, doughnutOptions);

        // END DOUGHNUT CHART

        // RADAR CHART

        var radarData = {
            labels: ["Eating", "Drinking", "Sleeping", "Designing", "Coding", "Cycling", "Running"],
            datasets: [
                {
                    label: "My First dataset",
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: [65, 59, 90, 81, 56, 55, 40]
                },
                {
                    label: "My Second dataset",
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
                    data: [28, 48, 40, 19, 96, 27, 100]
                }
            ]
        };

        var radarOptions = {
            //Boolean - Whether to show lines for each scale point
            scaleShowLine: true,
            //Boolean - Whether we show the angle lines out of the radar
            angleShowLineOut: true,
            //Boolean - Whether to show labels on the scale
            scaleShowLabels: false,
            // Boolean - Whether the scale should begin at zero
            scaleBeginAtZero: true,
            //String - Colour of the angle line
            angleLineColor: "rgba(0,0,0,.1)",
            //Number - Pixel width of the angle line
            angleLineWidth: 1,
            //String - Point label font declaration
            pointLabelFontFamily: "'Arial'",
            //String - Point label font weight
            pointLabelFontStyle: "normal",
            //Number - Point label font size in pixels
            pointLabelFontSize: 10,
            //String - Point label font colour
            pointLabelFontColor: "#666",
            //Boolean - Whether to show a dot for each point
            pointDot: true,
            //Number - Radius of each point dot in pixels
            pointDotRadius: 3,
            //Number - Pixel width of point dot stroke
            pointDotStrokeWidth: 1,
            //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
            pointHitDetectionRadius: 20,
            //Boolean - Whether to show a stroke for datasets
            datasetStroke: true,
            //Number - Pixel width of dataset stroke
            datasetStrokeWidth: 2,
            //Boolean - Whether to fill the dataset with a colour
            datasetFill: true,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
        };

        // render chart
        var ctx = document.getElementById("radarChart").getContext("2d");
        myNewChart_5 = new Chart(ctx).Radar(radarData, radarOptions);

        // END RADAR CHART

        // PIE CHART

        var pieOptions = {
            //Boolean - Whether we should show a stroke on each segment
            segmentShowStroke: true,
            //String - The colour of each segment stroke
            segmentStrokeColor: "#fff",
            //Number - The width of each segment stroke
            segmentStrokeWidth: 2,
            //Number - Amount of animation steps
            animationSteps: 100,
            //String - types of animation
            animationEasing: "easeOutBounce",
            //Boolean - Whether we animate the rotation of the Doughnut
            animateRotate: true,
            //Boolean - Whether we animate scaling the Doughnut from the centre
            animateScale: false,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%=segments[i].fillColor%>\"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>"
        };

        $.ajax({
            url: SOLR_URL + 'rss/select?q=*%3A*&rows=0&wt=json&indent=true&facet=true&facet.field=portalName&omitHeader=true',
            type: "GET",
            dataType: "jsonp",
            jsonp: "json.wrf",
            contentType: "application/json; charset=utf-8",
            crossDomain: true
        }).done(function (result) {
            var dataPortal = result.facet_counts.facet_fields.portalName;
            var dataLength = result.facet_counts.facet_fields.portalName.length;
            for (var i = 0, l = dataLength; i < l; i += 2) {
                var oddPositionVal = dataPortal[i];
                var evenPositionVal = dataPortal[i + 1];
                var color;

                if (evenPositionVal <= 1000) {
                    color = "rgba(166, 72, 243,1)";
                } else if (evenPositionVal <= 5000) {
                    color = "(255, 0, 0, 0.4)";
                } else if (evenPositionVal <= 7500) {
                    color = "rgba(102, 153, 127,1)"
                } else if (evenPositionVal <= 12500) {
                    color = "rgba(169, 3, 41, 0.7)"
                } else if (evenPositionVal <= 14000) {
                    color = "rgba(151,187,220,0.8)"
                } else if (evenPositionVal <= 17500) {
                    color = "rgba(220,220,220,0.8)"
                } else if (evenPositionVal <= 20000) {
                    color = "rgba(101, 191, 240,1)"
                } else {
                    color = "rgba(243, 106, 72,0.8)"
                }

                pieData.push({
                    value: evenPositionVal,
                    color: color,
                    highlight: "rgba(220,220,220,0.8)",
                    label: oddPositionVal,
                    labelColor: "white"
                });
            }

            var ctx = document.getElementById("pieChart").getContext("2d");
            chartByPortalName = new Chart(ctx).Pie(pieData, pieOptions);
            drawSegmentValues(chartByPortalName);
        });
    };

    function initQuiz() {
        $selectQuizChart = $('#id_quiz');
        $.ajax({
            beforeSend: function (request) {
                request.setRequestHeader('Authorization', sessionStorage.getItem('token'));
            },
            url: BASE_URL + "master/quizes",
            dataType: "JSON",
            type: "GET",
            success: function (result) {
                if (typeof(result) === "undefined" || result === null) {
                    $selectQuizChart.html('<p>none available</p>');
                    $(".id_quiz").removeClass('ajax_loader');
                    return;
                }

                $selectQuizChart.html('');
                if ($.cookie('idQuiz') != null) {
                    idQuiz = $.cookie('idQuiz');
                    $selectQuizChart.append('<option value="' + $.cookie('idQuiz') + '">' + $.cookie('quizName') + '</option>');
                } else {
                    $selectQuizChart.append('<option value=""> -- Pilih Quiz -- </option>');
                }

                $.each(result, function (key, val) {
                    if (val.id !== $.cookie('idQuiz')) {
                        $("#id_quiz option[value=" + val.id + "]").hide();
                    }

                    $selectQuizChart.append('<option value="' + val.id + '">' + val.name + '</option>');
                });

                $(".id_quiz").removeClass('ajax_loader');
                initDataByQuiz(idQuiz);
            },
            error: function () {
                console.log('idQuiz');
                $selectQuizChart.html('<p>none available</p>');
            }
        });
    }

    function onComboBoxQuizChange() {
        idQuiz = $("#id_quiz option:selected").val();
        quizName = $("#id_quiz option:selected").text();
        $.cookie('idQuiz', idQuiz);
        $.cookie('quizName', quizName);
        initDataByQuiz(idQuiz);
    }

    function initDataByQuiz(idQuiz) {
        $.ajax({
            beforeSend: function (request) {
                request.setRequestHeader('Authorization', sessionStorage.getItem('token'));
            },
            url: BASE_URL + 'transaction/rating/questionnaires?id_quiz=' + idQuiz,
            type: "GET",
            success: function (result) {
                if (result.data.length != 0) {
                    initData(result.data);
                } else {
                    $("#dataArtikelRatingChart").hide();
                }
            }
        });
    }

    function initData(param) {
        $("#dataArtikelRatingChart").show();
        chartData = [];
        var chartOptions = {
            //Boolean - Whether we should show a stroke on each segment
            segmentShowStroke: true,
            //String - The colour of each segment stroke
            segmentStrokeColor: "#fff",
            //Number - The width of each segment stroke
            segmentStrokeWidth: 2,
            //Number - Amount of animation steps
            animationSteps: 100,
            //String - types of animation
            animationEasing: "easeOutBounce",
            //Boolean - Whether we animate the rotation of the Doughnut
            animateRotate: true,
            //Boolean - Whether we animate scaling the Doughnut from the centre
            animateScale: false,
            //Boolean - Re-draw chart on page resize
            responsive: true,
            //String - A legend template
            legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%=segments[i].fillColor%>\"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>"
        };

        $.each(param, function (index, value) {
            var portalName = value.portal.name;
            var rating = value.rating;
            var idPortal = value.portal.id;
            var total = (rating / value.total).toFixed(2);

            if (total <= 10) {
                color = "rgba(166, 72, 243,1)";
            } else if (total <= 20) {
                color = "(255, 0, 0, 0.4)";
            } else if (total <= 30) {
                color = "rgba(102, 153, 127,1)"
            } else if (total <= 40) {
                color = "rgba(169, 3, 41, 0.7)"
            } else if (total <= 50) {
                color = "rgba(151,187,220,0.8)"
            } else if (total <= 60) {
                color = "rgba(220,220,220,0.8)"
            } else if (total <= 70) {
                color = "rgba(101, 191, 240,1)"
            } else if (total <= 80) {
                color = "rgba(153, 65, 65,0.8)"
            } else if (total <= 90) {
                color = "rgba(193, 193, 4,0.8)"
            } else {
                color = "rgba(131, 191, 250,0.8)"
            }

            chartData.push({
                value: total,
                color: color,
                highlight: "rgba(220,220,220,0.8)",
                label: portalName,
                labelColor: "white"
            });

            var ctx = document.getElementById("dataArtikelRatingChart").getContext("2d");
            chartPortalNameByQuizByArtikel = new Chart(ctx).Pie(chartData, chartOptions);
        });
    }

    $("#dataArtikelRatingChart").click(
            function (evt) {
                $('.modal-detail-data-portal').modal('toggle');
                $(".new-tb-detail-data-portal").find("tbody").remove();
                var activePoints = chartPortalNameByQuizByArtikel.getSegmentsAtEvent(evt);
                $.ajax({
                    beforeSend: function (request) {
                        request.setRequestHeader('Authorization', sessionStorage.getItem('token'));
                    },
                    url: BASE_URL + 'transaction/rating/questionnaires?portal_name=' + activePoints[0].label + '&quiz_id=' + idQuiz + '&limit=0&offset=1000',
                    type: "GET",
                    success: function (result) {
                        console.log("re", result.data);
                        if (result.data.length != 0) {
                            $(".new-tb-detail-data-portal").append("<tbody class='tbody_news'>");
                            $.each(result.data, function (index, value) {
                                $('.modal-title').html("Detail Data Portal " + value.portal.name);
                                var tr = "<tr>" +
                                        "<td class='idPortal' style='display: none' >" + value.portal.id + "</td>" +
                                        "<td class='portalName' style='display: none'>" + value.portal.name + "</td>" +
                                        "<td class='title'>" + value.title + "</td>" +
                                        "<td class='rating' style='float: right'>" + value.rating + "</td>";

                                $(".new-tb-detail-data-portal").find("tbody").append(tr);
                            });

                            $(".new-tb-detail-data-portal").append("</tbody>");
                        }
                    }
                });
            }
    );

    function drawSegmentValues(chart) {
        var radius = chart.outerRadius;
        var canvas = document.getElementById("pieChart");
        var ctx = canvas.getContext("2d");
        var midX = canvas.width / 2;
        var midY = canvas.height / 2;

        for (var i = 0; i < chart.segments.length; i++) {
            ctx.fillStyle = "white";
            var textSize = canvas.width / 10;
            ctx.font = textSize + "px Verdana";
            // Get needed variables
            var value = chart.segments[i].value;
            var startAngle = chart.segments[i].startAngle;
            var endAngle = chart.segments[i].endAngle;
            if (endAngle === undefined) {
                endAngle = 0;
            }
            var middleAngle = startAngle + ((endAngle - startAngle) / 2);

            // Compute text location
            var posX = (radius / 2) * Math.cos(middleAngle) + midX;
            var posY = (radius / 2) * Math.sin(middleAngle) + midY;

            // Text offside by middle
            var w_offset = ctx.measureText(value).width / 2;
            var h_offset = textSize / 4;

            ctx.fillText(value, posX - w_offset, posY + h_offset);
        }

    }

    loadScript("js/plugin/chartjs/chart.min.js", pagefunction);

    // end pagefunction

    // destroy generated instances
    // pagedestroy is called automatically before loading a new page
    // only usable in AJAX version!

    var pagedestroy = function () {

        //destroy all charts
        myNewChart_1.destroy();
        myNewChart_1 = null;

        myNewChart_2.destroy();
        myNewChart_2 = null;

        myNewChart_3.destroy();
        myNewChart_3 = null;

        myNewChart_4.destroy();
        myNewChart_4 = null;

        myNewChart_5.destroy();
        myNewChart_5 = null;

        chartByPortalName.destroy();
        chartByPortalName = null;

        if (debugState) {
            root.console.log("✔ Chart.js charts destroyed");
        }
    };

    // end destroy

</script>
